{"$type":"GPMAutomateEditor.Models.Editor, GPMAutomateEditor.Models","before_init":{"$type":"GPMAutomateEditor.Models.NormalBlockNode, GPMAutomateEditor.Models","nodes":[{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":1,"element_xpath":null,"output_variable_name":"excelFilePath","delay":"0,0","id":"0dc50fcf-eaa6-45e9-a0ab-3252574ec7d9","display_text":null,"raw_input":"[{\"Key\":\"VALUE\",\"Value\":\"Excel file path\"},{\"Key\":\"ALLOW_USER_INPUT\",\"Value\":\"True\"},{\"Key\":\"USER_INPUT_TYPE\",\"Value\":\"Text\"}]","comment":"Excel file path"},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":1,"element_xpath":null,"output_variable_name":"sheetSaveData","delay":"0,0","id":"67ef27e9-38cd-42d0-a4ec-985d4cc366a9","display_text":null,"raw_input":"[{\"Key\":\"VALUE\",\"Value\":\"1\"},{\"Key\":\"ALLOW_USER_INPUT\",\"Value\":\"True\"},{\"Key\":\"USER_INPUT_TYPE\",\"Value\":\"Text\"}]","comment":"index sheet lưu thông tin trạng thái "},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":1,"element_xpath":null,"output_variable_name":"mailFromSource","delay":"0,0","id":"35100bee-0404-4dd0-9728-8125e955de9a","display_text":null,"raw_input":"[{\"Key\":\"VALUE\",\"Value\":\"account-security-noreply@accountprotection.microsoft.com\"},{\"Key\":\"ALLOW_USER_INPUT\",\"Value\":\"True\"},{\"Key\":\"USER_INPUT_TYPE\",\"Value\":\"Text\"}]","comment":"Nhập nguồn mà muốn đọc mail từ(Ví dụ verify@x.com)"},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":1,"element_xpath":null,"output_variable_name":"columnStatusMailTm","delay":"0,0","id":"57182d77-be30-44b1-b607-35a9d7fc0ea4","display_text":null,"raw_input":"[{\"Key\":\"VALUE\",\"Value\":\"Y\"},{\"Key\":\"ALLOW_USER_INPUT\",\"Value\":\"True\"},{\"Key\":\"USER_INPUT_TYPE\",\"Value\":\"Text\"}]","comment":"Cột ghi thông tin trạng thái mail tm"},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":1,"element_xpath":null,"output_variable_name":"mailTm","delay":"0,0","id":"b11a4128-16e9-4885-9d87-6a0cf7c76aea","display_text":null,"raw_input":"[{\"Key\":\"VALUE\",\"Value\":\"$mailTmTemp@soscandia.org\"},{\"Key\":\"ALLOW_USER_INPUT\",\"Value\":\"True\"},{\"Key\":\"USER_INPUT_TYPE\",\"Value\":\"Text\"}]","comment":"Tạo mail tm"},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":1,"element_xpath":null,"output_variable_name":"passwordMailTm","delay":"0,0","id":"5e9251f2-5e04-446b-9e23-f15f7a390dca","display_text":null,"raw_input":"[{\"Key\":\"VALUE\",\"Value\":\"$passwordBase\"},{\"Key\":\"ALLOW_USER_INPUT\",\"Value\":\"True\"},{\"Key\":\"USER_INPUT_TYPE\",\"Value\":\"Text\"}]","comment":"Tạo pass mail tm"}],"expanded":true,"id":"fa28ec44-da2f-4c07-a5bc-7f6e7b557464","display_text":null,"raw_input":null,"comment":"Before browser opened"},"main_logic":{"$type":"GPMAutomateEditor.Models.NormalBlockNode, GPMAutomateEditor.Models","nodes":[{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":68,"element_xpath":null,"output_variable_name":"mailTm","delay":"0,0","id":"ac1184c0-2ab2-449c-b7f0-da227089750c","display_text":null,"raw_input":"[{\"Key\":\"FILE_OR_CODE\",\"Value\":\"const a = `$mailTm`;\\r\\nreturn a.toLowerCase();\"}]","comment":null},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":29,"element_xpath":null,"output_variable_name":"resToken","delay":"200,500","id":"1b2e6d96-400f-4cf0-8e60-1c19d58a2be6","display_text":null,"raw_input":"[{\"Key\":\"URL\",\"Value\":\"https://api.mail.tm/token\"},{\"Key\":\"METHOD\",\"Value\":\"POST\"},{\"Key\":\"HEADER\",\"Value\":\"\"},{\"Key\":\"DATA\",\"Value\":\"{\\\"address\\\": \\\"$mailTm\\\", \\\"password\\\": \\r\\n\\\"$passwordMailTm\\\"}\"},{\"Key\":\"USE_PROFILE_PROXY\",\"Value\":\"True\"}]","comment":"Gọi api lấy token authorization"},{"$type":"GPMAutomateEditor.Models.IfBlockNode, GPMAutomateEditor.Models","nodes":[{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":22,"element_xpath":null,"output_variable_name":null,"delay":"100,100","id":"8319111f-45f8-4109-8a6c-7dbe77237248","display_text":null,"raw_input":"[{\"Key\":\"FILE_PATH\",\"Value\":\"$excelFilePath\"},{\"Key\":\"SHEET_ID\",\"Value\":\"$sheetSaveData\"},{\"Key\":\"COL_NAME_OR_INDEX\",\"Value\":\"$columnStatusMailTm\"},{\"Key\":\"ROW_INDEX\",\"Value\":\"$inputExcel[Z]\"},{\"Key\":\"DATA\",\"Value\":\"Không đăng nhập được mail TM\"}]","comment":"Không đăng nhập được mail TM"},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":76,"element_xpath":null,"output_variable_name":null,"delay":"0,0","id":"86e2dfab-0004-4949-9d1f-ade56df4979b","display_text":null,"raw_input":"[]","comment":"Dừng lại do không đọc được mail"}],"expanded":false,"id":"32ebbb86-c3ee-4588-bb2f-c3d1310afb62","display_text":null,"raw_input":"[{\"Key\":\"CONDITION\",\"Value\":\"!$resToken contains token\"}]","comment":"check nếu không lấy được token"},{"$type":"GPMAutomateEditor.Models.ElseBlockNode, GPMAutomateEditor.Models","nodes":[{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":10,"element_xpath":null,"output_variable_name":"token","delay":"200,200","id":"cf958c0f-a4f6-4384-8603-a4c4f6cb2230","display_text":null,"raw_input":"[{\"Key\":\"JSON\",\"Value\":\"$resToken\"},{\"Key\":\"NODES\",\"Value\":\"token\"}]","comment":"Lấy token từ response"},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":29,"element_xpath":null,"output_variable_name":"resMessages","delay":"200,500","id":"0b1f1f64-852d-4ab1-b921-b2b644efe1de","display_text":null,"raw_input":"[{\"Key\":\"URL\",\"Value\":\"https://api.mail.tm/messages\"},{\"Key\":\"METHOD\",\"Value\":\"GET\"},{\"Key\":\"HEADER\",\"Value\":\"Authorization: Bearer $token\"},{\"Key\":\"DATA\",\"Value\":\"\"},{\"Key\":\"USE_PROFILE_PROXY\",\"Value\":\"True\"}]","comment":"Gọi API lấy danh sách message"},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":10,"element_xpath":null,"output_variable_name":"arrMessages","delay":"100,100","id":"c4d0e0f9-5dfd-484b-8ad9-7cc8ea8b1ebd","display_text":null,"raw_input":"[{\"Key\":\"JSON\",\"Value\":\"$resMessages\"},{\"Key\":\"NODES\",\"Value\":\"hydra:member\"}]","comment":"Lấy mảng messages"},{"$type":"GPMAutomateEditor.Models.IfBlockNode, GPMAutomateEditor.Models","nodes":[{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":1,"element_xpath":null,"output_variable_name":"codeMailTm","delay":"0,0","id":"c0e01ba4-cedc-4dee-be2a-1a1d578b5a8a","display_text":null,"raw_input":"[{\"Key\":\"VALUE\",\"Value\":\"0\"},{\"Key\":\"ALLOW_USER_INPUT\",\"Value\":\"False\"},{\"Key\":\"USER_INPUT_TYPE\",\"Value\":\"Text\"}]","comment":"Trả về code mail tm = 0"}],"expanded":false,"id":"646740a8-1fd9-4f44-84a6-d7480bceab60","display_text":null,"raw_input":"[{\"Key\":\"CONDITION\",\"Value\":\"$arrMessages = []\"}]","comment":"Check nếu chưa có message"},{"$type":"GPMAutomateEditor.Models.ElseBlockNode, GPMAutomateEditor.Models","nodes":[{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":68,"element_xpath":null,"output_variable_name":"idMailTm","delay":"0,0","id":"d7e1d308-7319-4e35-a31e-04249fcb93ca","display_text":null,"raw_input":"[{\"Key\":\"FILE_OR_CODE\",\"Value\":\"function findNewest(arrMail) { if (!Array.isArray(arrMail) || arrMail.length === 0) { return null; } return arrMail.reduce((newest, mail) => { const newestDate = new Date(newest.createdAt); const currentDate = new Date(mail.createdAt); return currentDate > newestDate ? mail : newest; }); } const arrMessages = $arrMessages; const arrUnseen = arrMessages.filter((temp) => { return temp.from.address == `$mailFromSource` && temp.seen == false; }); const newestMail = findNewest(arrUnseen); return (newestMail? newestMail.id : null);\"}]","comment":"Lấy id mail mới nhất của X"},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":1,"element_xpath":null,"output_variable_name":"idMailTm","delay":"0,0","id":"a9f95585-b6bd-4aff-b8bd-a38d27a68c2c","display_text":null,"raw_input":"[{\"Key\":\"VALUE\",\"Value\":\"$idMailTm\"},{\"Key\":\"ALLOW_USER_INPUT\",\"Value\":\"False\"},{\"Key\":\"USER_INPUT_TYPE\",\"Value\":\"Text\"}]","comment":"set id mail tm"},{"$type":"GPMAutomateEditor.Models.IfBlockNode, GPMAutomateEditor.Models","nodes":[{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":1,"element_xpath":null,"output_variable_name":"codeMailTm","delay":"0,0","id":"ff73a0d9-f90c-4e05-8727-06bd6454c201","display_text":null,"raw_input":"[{\"Key\":\"VALUE\",\"Value\":\"0\"},{\"Key\":\"ALLOW_USER_INPUT\",\"Value\":\"False\"},{\"Key\":\"USER_INPUT_TYPE\",\"Value\":\"Text\"}]","comment":"Trả về code mail tm = 0 nếu không lấy được id"}],"expanded":true,"id":"bbbe53bc-7020-4e52-a8e1-7eac2d6bc5e8","display_text":null,"raw_input":"[{\"Key\":\"CONDITION\",\"Value\":\"$idMailTm == null\"}]","comment":"Trả về code mail tm = 0 nếu không lấy được id"},{"$type":"GPMAutomateEditor.Models.ElseBlockNode, GPMAutomateEditor.Models","nodes":[{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":29,"element_xpath":null,"output_variable_name":"resMsg","delay":"200,500","id":"23f96cec-6a1a-4515-9eb2-0d41e73cbc32","display_text":null,"raw_input":"[{\"Key\":\"URL\",\"Value\":\"https://api.mail.tm/messages/$idMailTm\"},{\"Key\":\"METHOD\",\"Value\":\"GET\"},{\"Key\":\"HEADER\",\"Value\":\"Authorization: Bearer $token\"},{\"Key\":\"DATA\",\"Value\":\"\"},{\"Key\":\"USE_PROFILE_PROXY\",\"Value\":\"True\"}]","comment":"Gọi API lấy thông tin chi tiết mail"},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":10,"element_xpath":null,"output_variable_name":"checkIdMsg","delay":"200,200","id":"55570254-d65d-4d94-aa7d-eac56157f73e","display_text":null,"raw_input":"[{\"Key\":\"JSON\",\"Value\":\"$resMsg\"},{\"Key\":\"NODES\",\"Value\":\"@id\"}]","comment":null},{"$type":"GPMAutomateEditor.Models.IfBlockNode, GPMAutomateEditor.Models","nodes":[{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":1,"element_xpath":null,"output_variable_name":"codeMailTm","delay":"100,200","id":"0593fb65-d01b-4cc4-82fd-003d978ccbd9","display_text":null,"raw_input":"[{\"Key\":\"VALUE\",\"Value\":\"0\"},{\"Key\":\"ALLOW_USER_INPUT\",\"Value\":\"False\"},{\"Key\":\"USER_INPUT_TYPE\",\"Value\":\"Text\"}]","comment":"Trả về code mail tm = 0"}],"expanded":true,"id":"112546e9-b95f-42c3-9cad-a561a312f7f5","display_text":null,"raw_input":"[{\"Key\":\"CONDITION\",\"Value\":\"$checkIdMsg contains errors\"}]","comment":"Nếu có lỗi trả về code mail tm = 0"},{"$type":"GPMAutomateEditor.Models.ElseBlockNode, GPMAutomateEditor.Models","nodes":[{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":10,"element_xpath":null,"output_variable_name":"textMailTm","delay":"100,200","id":"fdda4a69-48ad-4c1f-a3f2-42718638954a","display_text":null,"raw_input":"[{\"Key\":\"JSON\",\"Value\":\"$resMsg\"},{\"Key\":\"NODES\",\"Value\":\"text\"}]","comment":"lấy full text mail tm"},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":68,"element_xpath":null,"output_variable_name":"codeMailTm","delay":"100,200","id":"cb3b0836-27b4-417f-bf83-14113eb21412","display_text":null,"raw_input":"[{\"Key\":\"FILE_OR_CODE\",\"Value\":\"function findSixDigitNumbers(text) { if (typeof text !== \\\"string\\\") { return []; } const regex = /\\\\b\\\\d{6}\\\\b/g; const matches = text.match(regex); return matches || []; } const textMailTm = `$textMailTm`; const arrMatches = findSixDigitNumbers(textMailTm); return arrMatches.length ? arrMatches[0] : 0;\"}]","comment":"Lấy code mail TM"},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":1,"element_xpath":null,"output_variable_name":"codeMailTm","delay":"0,0","id":"40e7abae-0eaf-4616-9f9a-d048543ce094","display_text":null,"raw_input":"[{\"Key\":\"VALUE\",\"Value\":\"$codeMailTm\"},{\"Key\":\"ALLOW_USER_INPUT\",\"Value\":\"False\"},{\"Key\":\"USER_INPUT_TYPE\",\"Value\":\"Text\"}]","comment":"Set code mail tm"}],"expanded":true,"id":"a5cbb56c-9884-42e3-a3b3-d8c14dd7c849","display_text":null,"raw_input":"[]","comment":"Trường hợp ko lỗi vào chi tiết mail lấy code"}],"expanded":true,"id":"3b4096d5-094e-41df-af24-086f13446964","display_text":null,"raw_input":"[]","comment":"Lấy code từ id mail"}],"expanded":true,"id":"60312738-e53a-4e78-809f-19865d7a1bca","display_text":null,"raw_input":"[]","comment":"Đã có mail về"}],"expanded":true,"id":"b71d2fe1-b6d0-42e0-b685-932397da54fc","display_text":null,"raw_input":"[]","comment":"Trường hợp lấy được token"}],"expanded":true,"id":"b386ef2d-b36e-4dbc-8e84-68c961de23ca","display_text":null,"raw_input":null,"comment":"Main logic"},"after_quit":{"$type":"GPMAutomateEditor.Models.NormalBlockNode, GPMAutomateEditor.Models","nodes":[],"expanded":false,"id":"d9eae5f3-5c37-46a5-8fbc-0d5622e34f07","display_text":null,"raw_input":null,"comment":"After browser closed"}}