{"$type":"GPMAutomateEditor.Models.Editor, GPMAutomateEditor.Models","before_init":{"$type":"GPMAutomateEditor.Models.NormalBlockNode, GPMAutomateEditor.Models","nodes":[{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":1,"element_xpath":null,"output_variable_name":"excelFilePath","delay":"0,0","id":"27aac2a8-9dc6-451a-9e8b-4ea087109bb4","display_text":null,"raw_input":"[{\"Key\":\"VALUE\",\"Value\":\"Excel file path\"},{\"Key\":\"ALLOW_USER_INPUT\",\"Value\":\"True\"},{\"Key\":\"USER_INPUT_TYPE\",\"Value\":\"Text\"}]","comment":"Excel file path"},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":1,"element_xpath":null,"output_variable_name":"sheetSaveData","delay":"0,0","id":"6b4b9e5f-44dc-4d99-9a46-6c06dde06bbc","display_text":null,"raw_input":"[{\"Key\":\"VALUE\",\"Value\":\"1\"},{\"Key\":\"ALLOW_USER_INPUT\",\"Value\":\"True\"},{\"Key\":\"USER_INPUT_TYPE\",\"Value\":\"Text\"}]","comment":"index sheet lưu thông tin trạng thái "},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":1,"element_xpath":null,"output_variable_name":"mailFromSource","delay":"0,0","id":"b5f5d60a-aba4-492c-af52-bd228d4fff5f","display_text":null,"raw_input":"[{\"Key\":\"VALUE\",\"Value\":\"account-security-noreply@accountprotection.microsoft.com\"},{\"Key\":\"ALLOW_USER_INPUT\",\"Value\":\"True\"},{\"Key\":\"USER_INPUT_TYPE\",\"Value\":\"Text\"}]","comment":"Nhập nguồn mà muốn đọc mail từ(Ví dụ verify@x.com)"},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":1,"element_xpath":null,"output_variable_name":"columnStatusMailTm","delay":"0,0","id":"9fd5d591-b9f0-4eb4-9ed1-ff67831656c5","display_text":null,"raw_input":"[{\"Key\":\"VALUE\",\"Value\":\"Y\"},{\"Key\":\"ALLOW_USER_INPUT\",\"Value\":\"True\"},{\"Key\":\"USER_INPUT_TYPE\",\"Value\":\"Text\"}]","comment":"Cột ghi thông tin trạng thái mail tm"},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":1,"element_xpath":null,"output_variable_name":"mailTm","delay":"0,0","id":"8b0da439-93a2-49fa-8dc4-8cee80331c92","display_text":null,"raw_input":"[{\"Key\":\"VALUE\",\"Value\":\"$mailTmTemp@soscandia.org\"},{\"Key\":\"ALLOW_USER_INPUT\",\"Value\":\"True\"},{\"Key\":\"USER_INPUT_TYPE\",\"Value\":\"Text\"}]","comment":"Tạo mail tm"},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":1,"element_xpath":null,"output_variable_name":"passwordMailTm","delay":"0,0","id":"f9d6ed96-f929-42ea-9ea5-e0f858d5b295","display_text":null,"raw_input":"[{\"Key\":\"VALUE\",\"Value\":\"$passwordBase\"},{\"Key\":\"ALLOW_USER_INPUT\",\"Value\":\"True\"},{\"Key\":\"USER_INPUT_TYPE\",\"Value\":\"Text\"}]","comment":"Tạo pass mail tm"}],"expanded":true,"id":"7ff1c490-f75b-48ce-bd39-27e9980dfacc","display_text":null,"raw_input":null,"comment":"Before browser opened"},"main_logic":{"$type":"GPMAutomateEditor.Models.NormalBlockNode, GPMAutomateEditor.Models","nodes":[{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":68,"element_xpath":null,"output_variable_name":"mailTm","delay":"0,0","id":"920e7d02-b314-4327-8be9-a80449efd42d","display_text":null,"raw_input":"[{\"Key\":\"FILE_OR_CODE\",\"Value\":\"const a = `$mailTm`;\\r\\nreturn a.toLowerCase();\"}]","comment":null},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":29,"element_xpath":null,"output_variable_name":"resToken","delay":"200,500","id":"8c64e625-92ef-4e89-8e33-e40e52ba82a2","display_text":null,"raw_input":"[{\"Key\":\"URL\",\"Value\":\"https://api.mail.tm/token\"},{\"Key\":\"METHOD\",\"Value\":\"POST\"},{\"Key\":\"HEADER\",\"Value\":\"\"},{\"Key\":\"DATA\",\"Value\":\"{\\\"address\\\": \\\"$mailTm\\\", \\\"password\\\": \\r\\n\\\"$passwordMailTm\\\"}\"},{\"Key\":\"USE_PROFILE_PROXY\",\"Value\":\"True\"}]","comment":"Gọi api lấy token authorization"},{"$type":"GPMAutomateEditor.Models.IfBlockNode, GPMAutomateEditor.Models","nodes":[{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":22,"element_xpath":null,"output_variable_name":null,"delay":"100,100","id":"67da5584-7d71-44cb-a2f2-e02e2649f7ad","display_text":null,"raw_input":"[{\"Key\":\"FILE_PATH\",\"Value\":\"$excelFilePath\"},{\"Key\":\"SHEET_ID\",\"Value\":\"$sheetSaveData\"},{\"Key\":\"COL_NAME_OR_INDEX\",\"Value\":\"$columnStatusMailTm\"},{\"Key\":\"ROW_INDEX\",\"Value\":\"$inputExcel[Z]\"},{\"Key\":\"DATA\",\"Value\":\"Không đăng nhập được mail TM\"}]","comment":"Không đăng nhập được mail TM"},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":76,"element_xpath":null,"output_variable_name":null,"delay":"0,0","id":"278212fd-b551-4047-bf26-3bd4f7fb1803","display_text":null,"raw_input":"[]","comment":"Dừng lại do không đọc được mail"}],"expanded":false,"id":"578a5567-e26f-4ce2-bd4d-d00c23099844","display_text":null,"raw_input":"[{\"Key\":\"CONDITION\",\"Value\":\"!$resToken contains token\"}]","comment":"check nếu không lấy được token"},{"$type":"GPMAutomateEditor.Models.ElseBlockNode, GPMAutomateEditor.Models","nodes":[{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":10,"element_xpath":null,"output_variable_name":"token","delay":"200,200","id":"47102a37-6f88-4b0f-97b1-326f15d37f0c","display_text":null,"raw_input":"[{\"Key\":\"JSON\",\"Value\":\"$resToken\"},{\"Key\":\"NODES\",\"Value\":\"token\"}]","comment":"Lấy token từ response"},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":29,"element_xpath":null,"output_variable_name":"resMessages","delay":"200,500","id":"524ff07c-ef53-4e83-8158-ed030ae7669c","display_text":null,"raw_input":"[{\"Key\":\"URL\",\"Value\":\"https://api.mail.tm/messages\"},{\"Key\":\"METHOD\",\"Value\":\"GET\"},{\"Key\":\"HEADER\",\"Value\":\"Authorization: Bearer $token\"},{\"Key\":\"DATA\",\"Value\":\"\"},{\"Key\":\"USE_PROFILE_PROXY\",\"Value\":\"True\"}]","comment":"Gọi API lấy danh sách message"},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":10,"element_xpath":null,"output_variable_name":"arrMessages","delay":"100,100","id":"949576e1-2f5f-4480-936a-77625cab315f","display_text":null,"raw_input":"[{\"Key\":\"JSON\",\"Value\":\"$resMessages\"},{\"Key\":\"NODES\",\"Value\":\"hydra:member\"}]","comment":"Lấy mảng messages"},{"$type":"GPMAutomateEditor.Models.IfBlockNode, GPMAutomateEditor.Models","nodes":[{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":1,"element_xpath":null,"output_variable_name":"codeMailTm","delay":"0,0","id":"22846843-e98b-47b1-b4bf-4200e9395634","display_text":null,"raw_input":"[{\"Key\":\"VALUE\",\"Value\":\"0\"},{\"Key\":\"ALLOW_USER_INPUT\",\"Value\":\"False\"},{\"Key\":\"USER_INPUT_TYPE\",\"Value\":\"Text\"}]","comment":"Trả về code mail tm = 0"}],"expanded":false,"id":"dc6bc47e-5e17-49eb-a0af-8e01c4e380ce","display_text":null,"raw_input":"[{\"Key\":\"CONDITION\",\"Value\":\"$arrMessages = []\"}]","comment":"Check nếu chưa có message"},{"$type":"GPMAutomateEditor.Models.ElseBlockNode, GPMAutomateEditor.Models","nodes":[{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":68,"element_xpath":null,"output_variable_name":"idMailTm","delay":"0,0","id":"0996e736-243d-4f33-a18d-59fa917b2895","display_text":null,"raw_input":"[{\"Key\":\"FILE_OR_CODE\",\"Value\":\"function findNewest(arrMail) { if (!Array.isArray(arrMail) || arrMail.length === 0) { return null; } return arrMail.reduce((newest, mail) => { const newestDate = new Date(newest.createdAt); const currentDate = new Date(mail.createdAt); return currentDate > newestDate ? mail : newest; }); } const arrMessages = $arrMessages; const arrUnseen = arrMessages.filter((temp) => { return temp.from.address == `$mailFromSource` && temp.seen == false; }); const newestMail = findNewest(arrUnseen); return (newestMail? newestMail.id : null);\"}]","comment":"Lấy id mail mới nhất của X"},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":1,"element_xpath":null,"output_variable_name":"idMailTm","delay":"0,0","id":"e91d078c-65d2-45d5-a9f7-3c285340e55d","display_text":null,"raw_input":"[{\"Key\":\"VALUE\",\"Value\":\"$idMailTm\"},{\"Key\":\"ALLOW_USER_INPUT\",\"Value\":\"False\"},{\"Key\":\"USER_INPUT_TYPE\",\"Value\":\"Text\"}]","comment":"set id mail tm"},{"$type":"GPMAutomateEditor.Models.IfBlockNode, GPMAutomateEditor.Models","nodes":[{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":1,"element_xpath":null,"output_variable_name":"codeMailTm","delay":"0,0","id":"f4a92dd5-2683-4a95-b72c-a56bb6b0e29f","display_text":null,"raw_input":"[{\"Key\":\"VALUE\",\"Value\":\"0\"},{\"Key\":\"ALLOW_USER_INPUT\",\"Value\":\"False\"},{\"Key\":\"USER_INPUT_TYPE\",\"Value\":\"Text\"}]","comment":"Trả về code mail tm = 0 nếu không lấy được id"}],"expanded":true,"id":"8f90e5b4-ac4b-4089-938a-808725c631aa","display_text":null,"raw_input":"[{\"Key\":\"CONDITION\",\"Value\":\"$idMailTm == null\"}]","comment":"Trả về code mail tm = 0 nếu không lấy được id"},{"$type":"GPMAutomateEditor.Models.ElseBlockNode, GPMAutomateEditor.Models","nodes":[{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":29,"element_xpath":null,"output_variable_name":"resMsg","delay":"200,500","id":"622c719b-9644-4305-9c0c-42e38c077754","display_text":null,"raw_input":"[{\"Key\":\"URL\",\"Value\":\"https://api.mail.tm/messages/$idMailTm\"},{\"Key\":\"METHOD\",\"Value\":\"GET\"},{\"Key\":\"HEADER\",\"Value\":\"Authorization: Bearer $token\"},{\"Key\":\"DATA\",\"Value\":\"\"},{\"Key\":\"USE_PROFILE_PROXY\",\"Value\":\"True\"}]","comment":"Gọi API lấy thông tin chi tiết mail"},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":10,"element_xpath":null,"output_variable_name":"checkIdMsg","delay":"200,200","id":"97bbfdc2-372b-4914-9654-ec441b9ee132","display_text":null,"raw_input":"[{\"Key\":\"JSON\",\"Value\":\"$resMsg\"},{\"Key\":\"NODES\",\"Value\":\"@id\"}]","comment":null},{"$type":"GPMAutomateEditor.Models.IfBlockNode, GPMAutomateEditor.Models","nodes":[{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":1,"element_xpath":null,"output_variable_name":"codeMailTm","delay":"100,200","id":"21c69586-a537-4a20-b97a-c216615c30c1","display_text":null,"raw_input":"[{\"Key\":\"VALUE\",\"Value\":\"0\"},{\"Key\":\"ALLOW_USER_INPUT\",\"Value\":\"False\"},{\"Key\":\"USER_INPUT_TYPE\",\"Value\":\"Text\"}]","comment":"Trả về code mail tm = 0"}],"expanded":true,"id":"126e3388-70f0-4acd-8b39-1506c4384723","display_text":null,"raw_input":"[{\"Key\":\"CONDITION\",\"Value\":\"$checkIdMsg contains errors\"}]","comment":"Nếu có lỗi trả về code mail tm = 0"},{"$type":"GPMAutomateEditor.Models.ElseBlockNode, GPMAutomateEditor.Models","nodes":[{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":10,"element_xpath":null,"output_variable_name":"textMailTm","delay":"100,200","id":"9263c70b-3bbe-45c9-9974-d5cae8741e4a","display_text":null,"raw_input":"[{\"Key\":\"JSON\",\"Value\":\"$resMsg\"},{\"Key\":\"NODES\",\"Value\":\"text\"}]","comment":"lấy full text mail tm"},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":68,"element_xpath":null,"output_variable_name":"codeMailTm","delay":"100,200","id":"cb67c383-a761-4469-8709-d91910109dc3","display_text":null,"raw_input":"[{\"Key\":\"FILE_OR_CODE\",\"Value\":\"function findSixDigitNumbers(text) { if (typeof text !== \\\"string\\\") { return []; } const regex = /\\\\b\\\\d{6}\\\\b/g; const matches = text.match(regex); return matches || []; } const textMailTm = `$textMailTm`; const arrMatches = findSixDigitNumbers(textMailTm); return arrMatches.length ? arrMatches[0] : 0;\"}]","comment":"Lấy code mail TM"},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":1,"element_xpath":null,"output_variable_name":"codeMailTm","delay":"0,0","id":"cce652eb-9fa0-4a51-9b09-909e44880d0f","display_text":null,"raw_input":"[{\"Key\":\"VALUE\",\"Value\":\"$codeMailTm\"},{\"Key\":\"ALLOW_USER_INPUT\",\"Value\":\"False\"},{\"Key\":\"USER_INPUT_TYPE\",\"Value\":\"Text\"}]","comment":"Set code mail tm"}],"expanded":true,"id":"50c8ce96-a0b7-4e8e-9f29-ead404a80c11","display_text":null,"raw_input":"[]","comment":"Trường hợp ko lỗi vào chi tiết mail lấy code"}],"expanded":true,"id":"5b6638f1-8c12-4bec-b63d-06ead7ded273","display_text":null,"raw_input":"[]","comment":"Lấy code từ id mail"}],"expanded":false,"id":"927a27ff-3dd6-43a0-a155-e3ef2d37a3ed","display_text":null,"raw_input":"[]","comment":"Đã có mail về"}],"expanded":false,"id":"1e93e6cb-43da-40d3-bc80-ddd7dfde81cc","display_text":null,"raw_input":"[]","comment":"Trường hợp lấy được token"}],"expanded":true,"id":"e82a6006-3b93-4fb4-88dc-04cc45c8c997","display_text":null,"raw_input":null,"comment":"Main logic"},"after_quit":{"$type":"GPMAutomateEditor.Models.NormalBlockNode, GPMAutomateEditor.Models","nodes":[],"expanded":false,"id":"f9f6ed26-9e3e-4062-a8bc-5e5e2da0ad2e","display_text":null,"raw_input":null,"comment":"After browser closed"}}