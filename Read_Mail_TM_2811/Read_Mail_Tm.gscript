{"$type":"GPMAutomateEditor.Models.Editor, GPMAutomateEditor.Models","before_init":{"$type":"GPMAutomateEditor.Models.NormalBlockNode, GPMAutomateEditor.Models","nodes":[{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":1,"element_xpath":null,"output_variable_name":"excelFilePath","delay":"0,0","id":"d1977932-725e-4ac1-a672-585f6ac3c2ef","display_text":null,"raw_input":"[{\"Key\":\"VALUE\",\"Value\":\"Excel file path\"},{\"Key\":\"ALLOW_USER_INPUT\",\"Value\":\"True\"},{\"Key\":\"USER_INPUT_TYPE\",\"Value\":\"Text\"}]","comment":"Excel file path"},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":1,"element_xpath":null,"output_variable_name":"sheetSaveData","delay":"0,0","id":"00ffd124-0a7d-40c2-b2ba-99a8b60c4be3","display_text":null,"raw_input":"[{\"Key\":\"VALUE\",\"Value\":\"1\"},{\"Key\":\"ALLOW_USER_INPUT\",\"Value\":\"True\"},{\"Key\":\"USER_INPUT_TYPE\",\"Value\":\"Text\"}]","comment":"index sheet lưu thông tin trạng thái "},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":1,"element_xpath":null,"output_variable_name":"mailFrom","delay":"0,0","id":"a36489f6-1f66-4159-a2fd-a00b609132c3","display_text":null,"raw_input":"[{\"Key\":\"VALUE\",\"Value\":\"account-security-noreply@accountprotection.microsoft.com\"},{\"Key\":\"ALLOW_USER_INPUT\",\"Value\":\"True\"},{\"Key\":\"USER_INPUT_TYPE\",\"Value\":\"Text\"}]","comment":"Nhập nguồn mà muốn đọc mail từ(Ví dụ verify@x.com)"},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":1,"element_xpath":null,"output_variable_name":"columnStatusMailTm","delay":"0,0","id":"8558c8e6-193b-4177-bca5-239e415081cd","display_text":null,"raw_input":"[{\"Key\":\"VALUE\",\"Value\":\"Y\"},{\"Key\":\"ALLOW_USER_INPUT\",\"Value\":\"True\"},{\"Key\":\"USER_INPUT_TYPE\",\"Value\":\"Text\"}]","comment":"Cột ghi thông tin trạng thái mail tm"}],"expanded":true,"id":"e0cf10f4-427b-49b6-9571-8576e56a5bea","display_text":null,"raw_input":null,"comment":"Before browser opened"},"main_logic":{"$type":"GPMAutomateEditor.Models.NormalBlockNode, GPMAutomateEditor.Models","nodes":[{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":29,"element_xpath":null,"output_variable_name":"resToken","delay":"200,500","id":"3ace9de6-964a-4892-9abd-bcdc0b2464d1","display_text":null,"raw_input":"[{\"Key\":\"URL\",\"Value\":\"https://api.mail.tm/token\"},{\"Key\":\"METHOD\",\"Value\":\"POST\"},{\"Key\":\"HEADER\",\"Value\":\"\"},{\"Key\":\"DATA\",\"Value\":\"{\\\"address\\\": \\\"$mailTm\\\", \\\"password\\\": \\r\\n\\\"$passwordMailTm\\\"}\"},{\"Key\":\"USE_PROFILE_PROXY\",\"Value\":\"True\"}]","comment":"Gọi api lấy token authorization"},{"$type":"GPMAutomateEditor.Models.IfBlockNode, GPMAutomateEditor.Models","nodes":[{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":22,"element_xpath":null,"output_variable_name":null,"delay":"100,100","id":"5fe277f8-38b2-4584-825c-e85991a5b038","display_text":null,"raw_input":"[{\"Key\":\"FILE_PATH\",\"Value\":\"$excelFilePath\"},{\"Key\":\"SHEET_ID\",\"Value\":\"$sheetSaveData\"},{\"Key\":\"COL_NAME_OR_INDEX\",\"Value\":\"$columnStatusMailTm\"},{\"Key\":\"ROW_INDEX\",\"Value\":\"$inputExcel[Z]\"},{\"Key\":\"DATA\",\"Value\":\"Không đăng nhập được mail TM\"}]","comment":"Không đăng nhập được mail TM"},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":76,"element_xpath":null,"output_variable_name":null,"delay":"0,0","id":"533f2a8a-4657-4eb0-b4c8-669ef099b49d","display_text":null,"raw_input":"[]","comment":"Dừng lại do không đọc được mail"}],"expanded":false,"id":"4e577a24-c2d5-40d8-882e-909a5e518a36","display_text":null,"raw_input":"[{\"Key\":\"CONDITION\",\"Value\":\"!$resToken contains token\"}]","comment":"check nếu không lấy được token"},{"$type":"GPMAutomateEditor.Models.ElseBlockNode, GPMAutomateEditor.Models","nodes":[{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":10,"element_xpath":null,"output_variable_name":"token","delay":"200,200","id":"9466f3bd-d4fc-4655-8767-da78346acf7b","display_text":null,"raw_input":"[{\"Key\":\"JSON\",\"Value\":\"$resToken\"},{\"Key\":\"NODES\",\"Value\":\"token\"}]","comment":"Lấy token từ response"},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":29,"element_xpath":null,"output_variable_name":"resMessages","delay":"200,500","id":"55b94362-935a-4613-972d-289d43d36c24","display_text":null,"raw_input":"[{\"Key\":\"URL\",\"Value\":\"https://api.mail.tm/messages\"},{\"Key\":\"METHOD\",\"Value\":\"GET\"},{\"Key\":\"HEADER\",\"Value\":\"Authorization: Bearer $token\"},{\"Key\":\"DATA\",\"Value\":\"\"},{\"Key\":\"USE_PROFILE_PROXY\",\"Value\":\"True\"}]","comment":"Gọi API lấy danh sách message"},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":10,"element_xpath":null,"output_variable_name":"arrMessages","delay":"100,100","id":"0b31f7ea-8df4-48f6-a6f2-ee0ce2f63d26","display_text":null,"raw_input":"[{\"Key\":\"JSON\",\"Value\":\"$resMessages\"},{\"Key\":\"NODES\",\"Value\":\"hydra:member\"}]","comment":"Lấy mảng messages"},{"$type":"GPMAutomateEditor.Models.IfBlockNode, GPMAutomateEditor.Models","nodes":[{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":1,"element_xpath":null,"output_variable_name":"codeMailTm","delay":"0,0","id":"6e3dc0f0-0291-4728-9044-85b09bc88b9a","display_text":null,"raw_input":"[{\"Key\":\"VALUE\",\"Value\":\"0\"},{\"Key\":\"ALLOW_USER_INPUT\",\"Value\":\"False\"},{\"Key\":\"USER_INPUT_TYPE\",\"Value\":\"Text\"}]","comment":"Trả về code mail tm = 0"}],"expanded":false,"id":"f2d3c26d-f5c0-45cb-9888-49e352fade65","display_text":null,"raw_input":"[{\"Key\":\"CONDITION\",\"Value\":\"$arrMessages = []\"}]","comment":"Check nếu chưa có message"},{"$type":"GPMAutomateEditor.Models.ElseBlockNode, GPMAutomateEditor.Models","nodes":[{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":68,"element_xpath":null,"output_variable_name":"idMailTm","delay":"0,0","id":"1e96e11c-3dec-4202-aef6-89275318dada","display_text":null,"raw_input":"[{\"Key\":\"FILE_OR_CODE\",\"Value\":\"function findNewest(arrMail) { if (!Array.isArray(arrMail) || arrMail.length === 0) { return null; } return arrMail.reduce((newest, mail) => { const newestDate = new Date(newest.createdAt); const currentDate = new Date(mail.createdAt); return currentDate > newestDate ? mail : newest; }); } const arrMessages = $arrMessages; const arrUnseen = arrMessages.filter((temp) => { return temp.from.address == `$mailFrom` && temp.seen == false; }); const newestMail = findNewest(arrUnseen); return (newestMail? newestMail.id : null);\"}]","comment":"Lấy id mail mới nhất của X"},{"$type":"GPMAutomateEditor.Models.IfBlockNode, GPMAutomateEditor.Models","nodes":[{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":1,"element_xpath":null,"output_variable_name":"codeMailTm","delay":"0,0","id":"d7b08219-8a54-4833-a685-b1cd85e9233e","display_text":null,"raw_input":"[{\"Key\":\"VALUE\",\"Value\":\"0\"},{\"Key\":\"ALLOW_USER_INPUT\",\"Value\":\"False\"},{\"Key\":\"USER_INPUT_TYPE\",\"Value\":\"Text\"}]","comment":"Trả về code mail tm = 0 nếu không lấy được id"}],"expanded":true,"id":"1a9635c8-0b32-4b7b-8c0f-81878d44de93","display_text":null,"raw_input":"[{\"Key\":\"CONDITION\",\"Value\":\"$idMailTm == null\"}]","comment":"Trả về code mail tm = 0 nếu không lấy được id"},{"$type":"GPMAutomateEditor.Models.ElseBlockNode, GPMAutomateEditor.Models","nodes":[{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":29,"element_xpath":null,"output_variable_name":"resMsg","delay":"200,500","id":"5c2b6d61-9239-4029-8d34-e9aa79358ba0","display_text":null,"raw_input":"[{\"Key\":\"URL\",\"Value\":\"https://api.mail.tm/messages/$idMailTm\"},{\"Key\":\"METHOD\",\"Value\":\"GET\"},{\"Key\":\"HEADER\",\"Value\":\"Authorization: Bearer $token\"},{\"Key\":\"DATA\",\"Value\":\"\"},{\"Key\":\"USE_PROFILE_PROXY\",\"Value\":\"True\"}]","comment":"Gọi API lấy thông tin chi tiết mail"},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":10,"element_xpath":null,"output_variable_name":"checkIdMsg","delay":"200,200","id":"470bcfe6-46a0-48ba-9555-645d465fffb5","display_text":null,"raw_input":"[{\"Key\":\"JSON\",\"Value\":\"$resMsg\"},{\"Key\":\"NODES\",\"Value\":\"@id\"}]","comment":null},{"$type":"GPMAutomateEditor.Models.IfBlockNode, GPMAutomateEditor.Models","nodes":[{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":1,"element_xpath":null,"output_variable_name":"codeMailTm","delay":"100,200","id":"90109616-155a-4465-8a24-df8d7d9b9fed","display_text":null,"raw_input":"[{\"Key\":\"VALUE\",\"Value\":\"0\"},{\"Key\":\"ALLOW_USER_INPUT\",\"Value\":\"False\"},{\"Key\":\"USER_INPUT_TYPE\",\"Value\":\"Text\"}]","comment":"Trả về code mail tm = 0"}],"expanded":true,"id":"41b7f5af-e85b-4a9b-95c4-bca81dffdf44","display_text":null,"raw_input":"[{\"Key\":\"CONDITION\",\"Value\":\"$checkIdMsg contains errors\"}]","comment":"Nếu có lỗi trả về code mail tm = 0"},{"$type":"GPMAutomateEditor.Models.ElseBlockNode, GPMAutomateEditor.Models","nodes":[{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":10,"element_xpath":null,"output_variable_name":"textMailTm","delay":"100,200","id":"974e532b-2d8b-45e8-a7fe-93b6ec7f421a","display_text":null,"raw_input":"[{\"Key\":\"JSON\",\"Value\":\"$resMsg\"},{\"Key\":\"NODES\",\"Value\":\"text\"}]","comment":"lấy full text mail tm"},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":68,"element_xpath":null,"output_variable_name":"codeMailTm","delay":"100,200","id":"de0f36ed-15c3-4c01-b91b-d9131d324394","display_text":null,"raw_input":"[{\"Key\":\"FILE_OR_CODE\",\"Value\":\"function findSixDigitNumbers(text) { if (typeof text !== \\\"string\\\") { return []; } const regex = /\\\\b\\\\d{6}\\\\b/g; const matches = text.match(regex); return matches || []; } const textMailTm = `$textMailTm`; const arrMatches = findSixDigitNumbers(textMailTm); return arrMatches.length ? arrMatches[0] : 0;\"}]","comment":"Lấy code mail TM"},{"$type":"GPMAutomateEditor.Models.ActionNode, GPMAutomateEditor.Models","type":1,"element_xpath":null,"output_variable_name":"codeMailTm","delay":"0,0","id":"57acd230-4037-4e0d-b9f9-b78e93e29b9a","display_text":null,"raw_input":"[{\"Key\":\"VALUE\",\"Value\":\"$codeMailTm\"},{\"Key\":\"ALLOW_USER_INPUT\",\"Value\":\"False\"},{\"Key\":\"USER_INPUT_TYPE\",\"Value\":\"Text\"}]","comment":"Set code mail tm"}],"expanded":true,"id":"a3df7886-b4ea-497a-981f-b0c71d248990","display_text":null,"raw_input":"[]","comment":"Trường hợp ko lỗi vào chi tiết mail lấy code"}],"expanded":true,"id":"e83d1b1f-f571-41f2-bab2-6c4b6cbf8e3c","display_text":null,"raw_input":"[]","comment":"Lấy code từ id mail"}],"expanded":false,"id":"236c67fc-cf1c-43a1-b8e3-3845b2603341","display_text":null,"raw_input":"[]","comment":"Đã có mail về"}],"expanded":false,"id":"865745e0-9d71-4729-bcdc-ffa612ee4294","display_text":null,"raw_input":"[]","comment":"Trường hợp lấy được token"}],"expanded":true,"id":"4ff01a2d-932c-4f4a-9666-e3409fc1fe8b","display_text":null,"raw_input":null,"comment":"Main logic"},"after_quit":{"$type":"GPMAutomateEditor.Models.NormalBlockNode, GPMAutomateEditor.Models","nodes":[],"expanded":false,"id":"8f56021b-00d9-463c-8c9c-e2b509ada039","display_text":null,"raw_input":null,"comment":"After browser closed"}}